# Coolify Deployment Guide

## Prerequisites

1. Coolify instance running on your server
2. Git repository with your code
3. Domain configured in Coolify

## Deployment Steps

### 1. Create New Application in Coolify

1. Go to your Coolify dashboard
2. Click "New Application"
3. Choose "Docker Compose" as the source
4. Connect your Git repository
5. Set the following:
   - **Application Name**: `wattpad-downloader`
   - **Domain**: `qc0k4ck0oooscwkskws8gg4o.31.97.70.110.sslip.io`
   - **Port**: `80`

### 2. Environment Variables

Coolify will automatically set these variables:
- `CONTAINER_NAME`: Generated by Coolify
- `DOMAIN`: Your configured domain
- `PYTHONUNBUFFERED=1`
- `PYTHONPATH=/app/src`
- `TZ=UTC`

### 3. Build Configuration

The `docker-compose.yml` is configured for Coolify with:
- ✅ Coolify managed labels
- ✅ Traefik routing with environment variables
- ✅ Health checks
- ✅ Gzip compression
- ✅ Proper port configuration (80)

### 4. Deploy

1. Click "Deploy" in Coolify
2. Monitor the build logs
3. Check the application logs for any issues

## Verification

After deployment, verify:

1. **Container is running**:
   ```bash
   ssh root@31.97.70.110 "docker ps | grep wattpad-downloader"
   ```

2. **Application is accessible**:
   ```bash
   curl -v http://qc0k4ck0oooscwkskws8gg4o.31.97.70.110.sslip.io/
   ```

3. **Health check is passing**:
   ```bash
   ssh root@31.97.70.110 "docker inspect <container_name> | grep -A 10 Health"
   ```

## Troubleshooting

### Common Issues

1. **Build fails**: Check Dockerfile and dependencies
2. **Container won't start**: Check logs in Coolify
3. **502 Bad Gateway**: Verify Traefik labels and port configuration
4. **Health check fails**: Ensure application responds on port 80

### Debug Commands

```bash
# Check container status
docker ps -a | grep wattpad-downloader

# Check logs
docker logs <container_name>

# Check Traefik configuration
docker exec coolify-proxy cat /traefik/dynamic/default_redirect_503.yaml

# Test local connectivity
curl -v http://localhost:80
```

## Configuration Details

### Docker Compose Features

- **Multi-stage build**: Frontend + Backend in single container
- **Health checks**: Automatic container health monitoring
- **Traefik integration**: Automatic reverse proxy configuration
- **Gzip compression**: Optimized content delivery
- **Environment variables**: Coolify-compatible configuration

### Port Configuration

- **Internal Port**: 80 (FastAPI application)
- **External Access**: Through Traefik reverse proxy
- **Health Check**: HTTP GET on `/`

## Rollback

If deployment fails:

1. Go to Coolify dashboard
2. Click on your application
3. Go to "Deployments" tab
4. Click "Rollback" to previous version

## Monitoring

- **Logs**: Available in Coolify dashboard
- **Metrics**: Container resource usage
- **Health**: Automatic health checks every 30s
- **Uptime**: Coolify monitors application availability

## Security Notes

- Application runs as non-root user
- No sensitive data in environment variables
- Traefik handles SSL termination
- Container is isolated in Docker network

## Support

If you encounter issues:
1. Check Coolify logs first
2. Verify container health
3. Test connectivity
4. Check Traefik configuration
5. See [DEBUGGING.md](./DEBUGGING.md) for detailed troubleshooting
